<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noticias</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { escuela: { main: '#1E3A8A', accent: '#F59E0B', light: '#EFF6FF' } },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

    <nav class="bg-white shadow-md w-full z-50">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold text-escuela-main flex items-center gap-2">
                <span class="text-2xl">CCX</span>
            </a>
            <a href="../index.html" class="text-gray-600 hover:text-escuela-main font-medium transition">Volver al Inicio</a>
        </div>
    </nav>

    <article class="max-w-4xl mx-auto px-4 py-12">
        
        <div id="loading" class="text-center py-20">
            <p class="text-xl text-gray-500 animate-pulse">Cargando noticia...</p>
        </div>

        <div id="contenido-noticia" class="hidden bg-white rounded-2xl shadow-xl overflow-hidden">
            
            <div class="w-full h-[400px] relative">
                <img id="img-noticia" src="" alt="" class="w-full h-full object-cover">
                <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/80 to-transparent p-8">
                    <span id="fecha-noticia" class="bg-escuela-accent text-white px-3 py-1 rounded-full text-sm font-bold mb-2 inline-block"></span>
                    <h1 id="titulo-noticia" class="text-3xl md:text-5xl font-bold text-white leading-tight shadow-sm"></h1>
                </div>
            </div>

            <div class="p-8 md:p-12">
                <div id="cuerpo-texto" class="prose prose-lg max-w-none text-gray-600 leading-relaxed">
                    </div>
            </div>
        </div>

    </article>

    <footer class="text-center py-8 text-gray-500 text-sm">
        Â© 2024 CCX
    </footer>

    <script>
        const API_URL = 'http://localhost:1337';

        async function cargarDetalle() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            if (!id) {
                window.location.href = 'index.html'; 
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/noticias/${id}?populate=*`);
                const data = await response.json();
                
                const noticiaData = data.data; 
                const atributos = noticiaData.attributes || noticiaData;

                document.getElementById('titulo-noticia').innerText = atributos.titulo;
                document.getElementById('fecha-noticia').innerText = atributos.fecha || 'Reciente';

                let urlImagen = 'https://via.placeholder.com/800x400';
                const media = atributos.imagen;

                const imagenObj = Array.isArray(media) ? media[0] : media;
                
                if (imagenObj && (imagenObj.url || (imagenObj.attributes && imagenObj.attributes.url))) {
                    const urlRelativa = imagenObj.url || imagenObj.attributes.url;
                    urlImagen = `${API_URL}${urlRelativa}`;
                }
                document.getElementById('img-noticia').src = urlImagen;

                const cuerpoDiv = document.getElementById('cuerpo-texto');

                if (Array.isArray(atributos.contenido)) {
                    let html = '';
                    atributos.contenido.forEach(bloque => {
                        if (bloque.type === 'paragraph') {
                            const texto = bloque.children.map(child => child.text).join('');
                            html += `<p class="mb-4">${texto}</p>`;
                        }
                    });
                    cuerpoDiv.innerHTML = html;
                } else {
                    cuerpoDiv.innerText = atributos.contenido; 
                }

                // 4. Mostrar todo y ocultar "Cargando"
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('contenido-noticia').classList.remove('hidden');

            } catch (error) {
                console.error(error);
                document.getElementById('loading').innerText = "Error al cargar la noticia.";
            }
        }

        cargarDetalle();
    </script>
</body>
</html>